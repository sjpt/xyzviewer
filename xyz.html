<!DOCTYPE html>
<script>lastModified={}; lastModified.xyzhtml = `Last modified: 2020/11/08 18:52:40
`</script>
<html lang="en">
	<head>
		<title>Virus</title>
		<meta charset="utf-8">
        <style>
            td {text-align: center; border: solid 1px; }
			body {
				font-family: Monospace;
				background-color: #101010;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			a {
				color: #f00;
			}
            #gui {
                position: relative;
                top: 10px;
                z-index: 100;
                pointer-events: none;
            }
            #gui * {
                pointer-events: all;
            }
            #msgbox {
                pointer-events: none;
            }
            #ack {
                z-index: 100;
            }
            #colourbox { width: 20%; }

            .help {
                display: none;  /* overridden on :hover on previous element */
                background-color: #2f2f2f;
                border-color: rgb(255, 72, 89);
                border-style: solid;
                color: rgb(255, 72, 89);
                border-radius: 5px;
                opacity: 1.0;
                border-width: 1px 1px 1px 1px;
                clear: left;
                font-style: normal;
                left: 0px;
                margin: 10px;
                padding: 5px;
                position: absolute;
                text-align: left;
                /* top: 60px; */ /* leaving out seems best compromise, bottom odd on 'Save Main Image' */
                z-index: 2000;
                white-space: normal;
                pointer-events: none;
                text-indent: 0;
                min-width: 25em;
            }

            .helpabove {top: -70px;}  /* for help that hovers above the item, not below */

            :hover + .help {
                display: block;
            }

        </style>
        <script>
            window.onload = ()=>{
                console.log('document loaded');
                window.lastmod.textContent = lastModified.xyzhtml;
                init();
            }; 
            document.addEventListener("DOMContentLoaded",()=>{console.log('DOMContentLoaded loaded')});
        </script>
	</head>
	<body>
        <span id="lastmod"></span>
        <span style="text-align:center">Press 'Q' key to toggle help information</span>
        <span id="ack" style="position: fixed; right: 0px"></span>
        <div id="info" style="display:none">
            <p>On a small screen, scroll to the bottom to see the image.
            You can interact with the mouse: left button to rotate, centre button or wheel to zoom, right button to pan.
            <br>
            Keys include HOME to reset transform, Q to show hide this info, ESCAPE to clear 'stuck' keys, and first person movement:
        </p>
        <table>
            <tr>
                <td></td><td><b>W:</b> forward</td><td></td>
                <td></td>
                <td></td><td><b>I:</b> look up</td><td></td>
                <td></td>
                <td></td><td><b>&uarr;:</b> move up</td><td></td>


            <tr>
                <td><b>A:</b> left</td><td><b>S:</b> back</td><td><b>D:</b> right</td>
                <td></td>
                <td><b>J:</b> look left</td><td><b>K:</b> look down</td><td><b>L:</b> look right</td>
                <td></td>
                <td><b>&larr;:</b> move left</td><td><b>&darr;:</b> move down</td><td><b>&rarr;:</b> move right</td>
            </tr>


        </table>
         <p>
            On a phone or tablet use single finger rotate, two finger zoom and three finger pan.
        </p>
        </div>

        <div id='container'>
                <div id='gui'>
                <b>visible: </b>
                <span id='visibles'></span>
                <span class="help">toggle visibility of loaded dataset</span>
                <!-- <br>
                <b>VR resolution, enter VR at chosen resolution (exit VR, or on Chrome restart page, to change res:</b>
                    1<input type="radio" name="vrres" onclick="vrres(1);"/>
                    1.2<input type="radio" name="vrres" onclick="vrres(1.2);"/>
                    1.4 (standard)<input type="radio" name="vrres" onclick="vrres(1.4);"/> -->
                <br>
                <span>
                    <b>Z scale:</b>
                    1<input type="radio" id="zsc1" name="zscale" onclick="scale(1,1,1);"/>
                    2<input type="radio" id="zsc2" name="zscale" onclick="scale(1,1,2);"/>
                    5<input type="radio" id="zsc5" name="zscale" onclick="scale(1,1,5);"/>
                    10<input type="radio" id="zsc10" name="zscale" onclick="scale(1,1,10);"/>
                </span>
                <span class="help">select amount to exaggerate depth</span>
                <br>
                <b>View:</b>
                elevation:<input type="radio" id="elev" name="zscale" onclick="maingroup.rotation.set(Math.PI/2,0,0);"/>
                <span class="help">jump to elevation view</span>
                plan:<input type="radio" id="plan" name="zscale" onclick="maingroup.rotation.set(0,0,0);"/>
                <span class="help">jump to plan view</span>
                <br>
                <span>
                    <b>Colour by:</b>
                    <select onchange="dataToMarkersGui();" id="colourby">
                        <!-- will be filled in dynamically -->
                    </select>
                </span>
                <span class="help">Select a colouring strategy for this dataset from the dropdown.<br>
                    'custom' will use the fixed colour or custom javascript code in the box to the right.</span>
                <!-- can't find reliable single event or even events for when OK clicked with no change  -->
                <input type="color" id="colourpick" value="#c0c0c0"
                    onchange="dataToMarkersGui('choose');" onclick="dataToMarkersGui('choose');"/>
                <span class="help">Select a fixed colour for this dataset.</span>
                <input type="text" id="colourbox" onkeyup="dataToMarkersGui('custom');"/>
                <span class="help">Write custom colour code here.</span>
                <br>
                <span>
                <b>Spot size:</b>
                    0.01<input type="radio" name="spotsize" onclick="spotsize(0.01);"/>
                    0.02<input type="radio" name="spotsize" onclick="spotsize(0.02);"/>
                    0.05<input type="radio" name="spotsize" onclick="spotsize(0.05);"/>
                    0.1<input type="radio" name="spotsize" onclick="spotsize(0.1);"/>
                    0.2<input type="radio" name="spotsize" onclick="spotsize(0.2);"/>
                    0.5<input type="radio" name="spotsize" onclick="spotsize(0.5);"/>
                    1<input type="radio" name="spotsize" onclick="spotsize(1);"/>
                    2<input type="radio" name="spotsize" onclick="spotsize(2);"/>
                    5<input type="radio" name="spotsize" onclick="spotsize(5);"/>
                    10<input type="radio" name="spotsize" onclick="spotsize(10);"/>
                </span>
                <span class="help">Choose size of each point.</span>
                <br>
                <span>
                    <b>Filter:</b>
                    <textarea id="filterbox" rows="1" cols="40" onkeyup="filtergui(event);"></textarea>
                </span>
                <span class="help">Type custom javascript here for selection of points from dataset, and possibly colouring.
                    <br>ctrl-enter to apply.
                    <ul>
                        <li>green background indicates correct javascript but is pending application.</li>
                        <li>white background indicates javascript has been applied.</li>
                        <li>pink background indicates incorrect javascript.</li>
                        <li>blusih background indicates javascript inappropriate for this context.</li>
                    </ul>
                </span>
                <br>
                <p id="filterr"></p>
                <br>
                <p id="msgbox"></p>
                <input type="file" id="fileChooser" style="display:none"/>
            </div>
        </div>
		<script src="jsdeps/three109.js"></script>
		<script src="jsdeps/stats.min.js"></script>
		<script src="jsdeps/OrbitControls.js"></script>
		<script src="jsdeps/WebVR109.js"></script>
		<script src="jsdeps/PLYLoader.js"></script>

		<script src="main.js"></script>

        <!--
		<script type="module" src="graphicsboiler.js"></script>
		<script type="module" src="xyz.js"></script>
        <script type="module" src="refit.js"></script>
<script type="module" src="pdbreader.js"></script>
-->
<script type="module" src="folddemo.js"></script>
<script type="module" src="photoshader.js"></script>
<script type="module" src="geojson.js"></script>
<script type="module" src="refit.js"></script>
<script type="module" src="plyreader.js"></script>
<script type="module" src="grid.js"></script>
<script src="gldebug.js"></script>
<script>console.log('last module read, window=', window)</script>

		<!-- <script src="js/Detector.js"></script> -->
	</body>
</html>
<!-- 
https://combinatronics.com/sjpt/xyzviewer/master/xyz.html
https://gitcdn.link/cdn/sjpt/xyzviewer/master/xyz.html  (less dynamic)
-->